let ImageSys,InPutButton,SendButton,FileInput,fileFlag;function Even_init(){InPutButton=document.getElementById("Input_Button"),SendButton=document.getElementById("Send_Button"),FileInput=document.getElementById("File_Input"),ImageSys=document.getElementById("Image_Input"),InPutButton.addEventListener("click",InPutButton_Even),FileInput.addEventListener("change",FileInput_Even),SendButton.addEventListener("click",SendButton_Even)}function InPutButton_Even(){FileInput.click()}function FileInput_Even(e){if(fileFlag=0,file=e.target.files[0],!file)return void alert("未选择文件");if(!file.type.startsWith("image/"))return void alert("请选择图片文件");if(!file.name.toLowerCase().endsWith(".bmp"))return void alert("请选择 BMP 图片文件");const t=new FileReader;t.onload=function(e){const t=new Uint8Array(e.target.result);if(66!==t[0]||77!==t[1])return void alert("无效的 BMP 文件");const n=t[18]|t[19]<<8|t[20]<<16|t[21]<<24,i=t[22]|t[23]<<8|t[24]<<16|t[25]<<24;if(24!==t[28])return void alert("请选择 24 位 BMP 文件");if(!(800===n&&480===i||480===n&&800===i))return void alert(`BMP 图像分辨率必须为 800x480 或 480x800,当前为 ${n}x${i}`);const o=URL.createObjectURL(file);ImageSys.src=o,ImageSys.onload=()=>{URL.revokeObjectURL(o)},fileFlag=1},t.readAsArrayBuffer(file)}function SendButton_Even(){fileFlag?fetch("/dataUP",{method:"POST",headers:{"Content-Type":file.type},body:file}).then((e=>e.text())).then((e=>{alert("上传成功："+e)})).catch((e=>{console.error("上传失败:",e),alert("上传失败！")})):alert("请选择图片文件")}document.addEventListener("DOMContentLoaded",Even_init);